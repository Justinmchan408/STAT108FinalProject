---
title: "Analysis"
author: "Justin Chan and Isaac Plotkin"
date: "3/3/2022"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Narrative
## Research Question
### Background
One of the hardest things for investments is to decide whether the amount to pay for that investment will have a great return. Often times, people struggle choosing what is the best car for them and if they are paying a fair price for that type of car. However, it can be hard to estimate a fair price for a car due to a number of various features such as car brand, car model, engine type, horsepower, car size and many other features that can be hard to compare car prices depending on different features.

### Motivation
In this project, we want to make it easier for others to be able to actually determine if they are receiving fair price for the car they are purchasing. Many salesmen try to upsell a car to make more commissions on a car where some may be overpaying for a car when comparing to its market price. To be able to determine people are getting a fair price for a car, we hope to create a linear regression model that can accurate predict car price based on these various car features.

### Hypothesis
When making the linear regression model, we hypothesize that car brand (carName), type of car body (carBody), and fuel type (fueltype) will be the largest factors when determining a car's price. Furthermore, we believe that a linear regression model will be the ideal model to use to predict car prices.

## Dataset
### Obervations
The obervations of the dataset are pretty straight forward where each obervation or row is a car with the columns being various features of the car. The dataset includes 26 columns where one column is an obervation index and another column is car price which is the variable we are trying to predict so we have 24 input or car features for 205 observations/cars that we can use our linear regression model.

### General Description of Variables

The following is the data dictionary of our dataset that gives a clear description of each variable and the type of variable (categorical, continuous/numeric) for each of our possible inputs to use in the linear model from our dataset.

```{r packages, echo=FALSE, message=FALSE, warning=FALSE}
library(tidyverse)
```

# ```{r car variables, echo=T}
# print(car_data_dictionary, n = 25)
# ```

### Data Collection
The data was originally collected from various market surveys of different types of cars across the United States market around 1987 to learn how to price cars in China depending on the American market. There is an assumption that the cars in the data set have been randomly chosen from the set of cars in the various market surveys. Link to the dataset: <https://www.kaggle.com/hellbuoy/car-price-prediction>

```{r car data download, echo=FALSE, message=FALSE, warning=FALSE}
library(knitr)
library(broom)
library(cowplot)
library(patchwork)
car_data <- read_csv("~/Desktop/School/STAT108/STAT108FinalProject/data/CarPrice_Assignment.csv")
glimpse(car_data)
```


# Analysis
## EDA
```{r price, echo= TRUE}
ggplot(data = car_data, aes(x = price)) + 
  geom_histogram() + 
  labs(x = "Price", 
       y = "Counts", 
       title = "Price Distribution")

```

```{r price summary statistics, echo= TRUE}
car_data %>%
  summarise(min = min(price), 
            q1 = quantile(price, probs = c(0.25)), 
            median = median(price), 
            q3 = quantile(price, probs = c(0.75)), 
            max = max(price), 
            iqr = IQR(price), 
            mean = mean(price), 
            std_dev = sd(price)
            )

```

```{r univariate predictor variables, echo= TRUE}
p1 <- ggplot(data = car_data, aes(x = symboling)) + 
  geom_bar() + 
  labs(x = "Symboling", 
       y = "Counts", 
       title = "Symboling Distribution")

p2 <- ggplot(data = car_data, aes(x = drivewheel)) + 
  geom_bar() + 
  labs(x = "Drive Wheel", 
       y = "Counts", 
       title = "Drive Wheel Distribution")

p3 <- ggplot(data = car_data, aes(x = fueltype)) + 
  geom_bar() + 
  labs(x = "Fuel Type", 
       y = "Counts", 
       title = "Fuel Type Distribution")

p4 <- ggplot(data = car_data, aes(x = aspiration)) + 
  geom_bar() + 
  labs(x = "Aspiration", 
       y = "Counts", 
       title = "Aspiration Distribution")

p5 <- ggplot(data = car_data, aes(x = doornumber)) + 
  geom_bar() + 
  labs(x = "Door Number", 
       y = "Counts", 
       title = "Door Number Distribution")

p6 <- ggplot(data = car_data, aes(x = carbody)) + 
  geom_bar() + 
  labs(x = "Car Body", 
       y = "Counts", 
       title = "Car Body Distribution")

p7 <- ggplot(data = car_data, aes(x = CarName)) + 
  geom_bar() + 
  labs(x = "Car Name", 
       y = "Counts", 
       title = "Car Name Distribution")

p8 <- ggplot(data = car_data, aes(x = wheelbase)) + 
  geom_histogram() + 
  labs(x = "Wheelbase", 
       y = "Counts", 
       title = "Wheelbase Distribution")

p9 <- ggplot(data = car_data, aes(x = carlength)) + 
  geom_histogram() + 
  labs(x = "Car Length", 
       y = "Counts", 
       title = "Car Length Distribution")

p10 <- ggplot(data = car_data, aes(x = carwidth)) + 
  geom_histogram() + 
  labs(x = "Car Width", 
       y = "Counts", 
       title = "Car Width Distribution")

p11 <- ggplot(data = car_data, aes(x = carheight)) + 
  geom_histogram() + 
  labs(x = "Car Height", 
       y = "Counts", 
       title = "Car Height Distribution")

p12 <- ggplot(data = car_data, aes(x = curbweight)) + 
  geom_histogram() + 
  labs(x = "Curb Weight", 
       y = "Counts", 
       title = "Curb Weight Distribution")

p13 <- ggplot(data = car_data, aes(x = enginetype)) + 
  geom_bar() + 
  labs(x = "Engine Type", 
       y = "Counts", 
       title = "Engine Type Distribution")

p14 <- ggplot(data = car_data, aes(x = cylindernumber)) + 
  geom_bar() + 
  labs(x = "Cylinder Number", 
       y = "Counts", 
       title = "Cylinder Number Distribution")

p15 <- ggplot(data = car_data, aes(x = enginesize)) + 
  geom_histogram() + 
  labs(x = "Engine Size", 
       y = "Counts", 
       title = "Engine Size Distribution")

p16 <- ggplot(data = car_data, aes(x = fuelsystem)) + 
  geom_bar() + 
  labs(x = "Fuel System", 
       y = "Counts", 
       title = "Fuel System Distribution")

p17 <- ggplot(data = car_data, aes(x = boreratio)) + 
  geom_histogram() + 
  labs(x = "Bore Ratio", 
       y = "Counts", 
       title = "Bore Ratio Distribution")

p18 <- ggplot(data = car_data, aes(x = stroke)) + 
  geom_histogram() + 
  labs(x = "Stroke", 
       y = "Counts", 
       title = "Stroke Distribution")

p19 <- ggplot(data = car_data, aes(x = compressionratio)) + 
  geom_histogram() + 
  labs(x = "Compression Ratio", 
       y = "Counts", 
       title = "Compression Ratio Distribution")

p20 <- ggplot(data = car_data, aes(x = horsepower)) + 
  geom_histogram() + 
  labs(x = "Horsepower", 
       y = "Counts", 
       title = "Horsepower Distribution")

p21 <- ggplot(data = car_data, aes(x = peakrpm)) + 
  geom_histogram() + 
  labs(x = "Peak RPM", 
       y = "Counts", 
       title = "Peak RPM Distribution")

p22 <- ggplot(data = car_data, aes(x = citympg)) + 
  geom_histogram() + 
  labs(x = "City MPG", 
       y = "Counts", 
       title = "City MPG Distribution")

p23 <- ggplot(data = car_data, aes(x = highwaympg)) + 
  geom_histogram() + 
  labs(x = "Highway MPG", 
       y = "Counts", 
       title = "Highway MPG Distribution")

(p1+p2+p3)/(p4+p5+p8)
(p9+p10+p11)/(p12+p13+p14)
(p15+p17+p18)/(p19+p20+p21)
(p22+p23)/(p6 + p16)
p7
```

```{r bivariate predictor variables, echo= TRUE}
b1 <- ggplot(data = car_data, aes(x = as.factor(symboling), y = price)) + 
  geom_boxplot() + 
  labs(x = "Symboling", 
       y = "Price", 
       title = "Price vs Symboling")

b2 <- ggplot(data = car_data, aes(x = drivewheel, y = price)) + 
  geom_boxplot() + 
  labs(x = "Drive Wheel", 
       y = "price", 
       title = "Price vs Drive Wheel")

b3 <- ggplot(data = car_data, aes(x = fueltype, y = price)) + 
  geom_boxplot() + 
  labs(x = "Fuel Type", 
       y = "Price", 
       title = "Price vs Fuel Type")

b4 <- ggplot(data = car_data, aes(x = aspiration, y = price)) + 
  geom_boxplot() + 
  labs(x = "Aspiration", 
       y = "Price", 
       title = "Price vs Aspiration")

b5 <- ggplot(data = car_data, aes(x = doornumber, y = price)) + 
  geom_boxplot() + 
  labs(x = "Door Number", 
       y = "Price", 
       title = "Price vs Door Number")

b6 <- ggplot(data = car_data, aes(x = carbody, y = price)) + 
  geom_boxplot() + 
  labs(x = "Car Body", 
       y = "Price", 
       title = "Price vs Car Body")

b7 <- ggplot(data = car_data, aes(x = CarName, y = price)) + 
  geom_boxplot() + 
  labs(x = "Car Name", 
       y = "Price", 
       title = "Price vs Car Name")

b8 <- ggplot(data = car_data, aes(x = wheelbase, y = price)) + 
  geom_point() + 
  labs(x = "Wheelbase", 
       y = "Price", 
       title = "Price vs Wheelbase")

b9 <- ggplot(data = car_data, aes(x = carlength, y = price)) + 
  geom_point() + 
  labs(x = "Car Length", 
       y = "Price", 
       title = "Price vs Car Length")

b10 <- ggplot(data = car_data, aes(x = carwidth, y = price)) + 
  geom_point() + 
  labs(x = "Car Width", 
       y = "Price", 
       title = "Price vs Car Width")

b11 <- ggplot(data = car_data, aes(x = carheight, y = price)) + 
  geom_point() + 
  labs(x = "Car Height", 
       y = "Price", 
       title = "Price vs Car Height")

b12 <- ggplot(data = car_data, aes(x = curbweight, y = price)) + 
  geom_point() + 
  labs(x = "Curb Weight", 
       y = "Price", 
       title = "Price vs Curb Weight")

b13 <- ggplot(data = car_data, aes(x = enginetype, y = price)) + 
  geom_boxplot() + 
  labs(x = "Engine Type", 
       y = "Price", 
       title = "Price vs Engine Type")

b14 <- ggplot(data = car_data, aes(x = cylindernumber, y = price)) + 
  geom_boxplot() + 
  labs(x = "Cylinder Number", 
       y = "Price", 
       title = "Price vs Cylinder Number")

b15 <- ggplot(data = car_data, aes(x = enginesize, y = price)) + 
  geom_point() + 
  labs(x = "Engine Size", 
       y = "Price", 
       title = "Price vs Engine Size")

b16 <- ggplot(data = car_data, aes(x = fuelsystem, y = price)) + 
  geom_boxplot() + 
  labs(x = "Fuel System", 
       y = "Price", 
       title = "Price vs Fuel System")

b17 <- ggplot(data = car_data, aes(x = boreratio, y = price)) + 
  geom_point() + 
  labs(x = "Bore Ratio", 
       y = "Price", 
       title = "Price vs Bore Ratio")

b18 <- ggplot(data = car_data, aes(x = stroke, y = price)) + 
  geom_point() + 
  labs(x = "Stroke", 
       y = "Price", 
       title = "Price vs Stroke")

b19 <- ggplot(data = car_data, aes(x = compressionratio, y = price)) + 
  geom_point() + 
  labs(x = "Compression Ratio", 
       y = "Price", 
       title = "Price vs Compression Ratio")

b20 <- ggplot(data = car_data, aes(x = horsepower, y = price)) + 
  geom_point() + 
  labs(x = "Horsepower", 
       y = "Price", 
       title = "Price vs Horsepower")

b21 <- ggplot(data = car_data, aes(x = peakrpm, y = price)) + 
  geom_point() + 
  labs(x = "Peak RPM", 
       y = "Price", 
       title = "Price vs Peak RPM")

b22 <- ggplot(data = car_data, aes(x = citympg, y = price)) + 
  geom_point() + 
  labs(x = "City MPG", 
       y = "Price", 
       title = "Price vs City MPG")

b23 <- ggplot(data = car_data, aes(x = highwaympg, y = price)) + 
  geom_point() + 
  labs(x = "Highway MPG", 
       y = "Price", 
       title = "Price vs Highway MPG")

(b1+b2+b3)/(b4+b5+b8) # Wheelbase, symboling, drive wheel, aspiration
(b9+b10+b11)/(b12+b13+b14) # Cylinder num, curb weight, car length, car width
(b15+b17+b18)/(b19+b20+b21) # Engine size, horsepower, bore ration
(b22+b23)/(b6 + b16) # fuel system, city mpg, highway mpg
b7
```
```{r multivariate predictor variables, echo= TRUE}

m1 <- ggplot(data = car_data, aes(x = highwaympg, y = citympg, color = price)) + 
  geom_point() + 
  labs(x = "Highway MPG", 
       y = "City MPG", 
       title = "City MPG vs Highway MPG")


m2 <- ggplot(data = car_data, aes(x = carlength, y = carwidth, color = price)) + 
  geom_point() + 
  labs(x = "Car Length", 
       y = "Car Width", 
       title = "Car Width vs Car Length")

m3 <- ggplot(data = car_data, aes(x = carlength, y = carheight, color = price)) + 
  geom_point() + 
  labs(x = "Car Length", 
       y = "Car Height", 
       title = "Car Height vs Car Length")

m4 <- ggplot(data = car_data, aes(x = carwidth, y = carheight, color = price)) + 
  geom_point() + 
  labs(x = "Car Width", 
       y = "Car Height", 
       title = "Car Height vs Car Width")

(m1+m2)/(m3+m4)
```


```{r predictor variables summary statistics, echo= TRUE}
summary(car_data)
```


```{r best model, echo= TRUE}
library(MuMIn)
full.model <- lm(price ~ symboling+CarName+fueltype+aspiration+doornumber+carbody+drivewheel+enginelocation+wheelbase+carlength+carwidth+carheight+curbweight+enginetype+cylindernumber, car_data, na.action = "na.fail")
# +doornumber+carbody+drivewheel+enginelocation+wheelbase+carlength+carwidth+carheight+curbweight+enginetype+cylindernumber+enginesize+fuelsystem+boreratio+stroke+compressionratio+horsepower+peakrpm+citympg+highwaympg
dredge(full.model)
```